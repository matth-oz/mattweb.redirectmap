# Модуль «Карта редиректов» (mattweb.redirectmap) для БУС

Модуль «Карта редиректов» (**mattweb.redirectmap**) предназначен для хранения записей для перенаправления со старых url’ов на новые. 

Будет полезен при создании нового сайта и переноса контента со старого на новый сайт. 

Для установки разместите папку mattweb.redirectmap со всем ее содержимым в _/bitrix/modules/_ и запустите установку на странице в административной части сайта (**Marketplace → Установленные решения**).

После установки страницы модуля размещаются в разделе **Сервисы → Карта редиректов**.

Данные хранятся в таблице БД в следующем формате: старый url, новый url, заметка о редиректе. Заметка является необязательным полем.

Список редиректов можно увидеть на странице в административной части сайта.

На странице со списком можно добавлять, редактировать и удалять записи.

301 редирект срабатывает по стандартному событию `OnBeforeProlog` главного модуля Битрикса. 

Также создан скрипт для загрузки записей редиректов из csv-файла.

Шаблон файла можно скачать на главной странице модуля в административной части сайта.

Для корркетной работы модуля нужно проверить прописаны ли какие-либо редиректы в файле _.htaccess_

Например, если в _.htaccess_ записаны директивы для редиректа на страницы с слэшем в конце и вам нужно создать редирект для несуществующего файла _/test.php_ на раздел сайта с контактами _/contacts/_, то при указании в модуле url без слэша редирект происходить не будет.

Для решения этой проблемы, в .htaccess нужно добавить условие:

```
RewriteCond %{REQUEST_URI} !.(php|html?|jpg|gif)$
```

Полный набор условий и правил будет следующим:

```
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteCond %{REQUEST_URI} !.(php|html?|jpg|gif)$
  RewriteRule ^(.\\\*\\\[^/\\\])$ /$1/ \\\[R=301,L\\\]
```